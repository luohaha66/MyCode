// c51 header
#include <AT89X52.h>

// with code, it will be put to flash
// without, it will be put to raw, raw is very small
unsigned char code Font[] = {
0x04,0x24,0x24,0x24,0x7F,0xC4,0x44,0x04,0x04,0xFF,0x04,0x44,0x34,0x05,0x04,0x00,
0x00,0x10,0x12,0x21,0xFE,0x40,0x82,0x02,0x04,0xC8,0x30,0x28,0x44,0x82,0x1F,0x00,
0x01,0x26,0x34,0x2C,0x24,0x24,0x37,0x4C,0x44,0x44,0x4C,0x74,0xC4,0x45,0x06,0x00,
0x00,0x82,0x84,0x89,0x91,0xE1,0xB2,0xAA,0xA4,0xA4,0xAA,0xB2,0x81,0x01,0x01,0x00,
0x00,0x01,0x06,0x1F,0xE0,0x02,0x04,0x18,0xF0,0x10,0x13,0x10,0x10,0x14,0x18,0x00,
0x80,0x00,0x00,0xFF,0x00,0x08,0x30,0xC0,0x02,0x01,0xFE,0x00,0x80,0x60,0x18,0x00,
};

// set I/O
sbit U15E3 = P1 ^ 3; // the E3 pin of U15(74HC138) connect to P1_3 pin
sbit U14E3 = P1 ^ 4;

void main(void)
{
    unsigned char m = 0;
    unsigned int n = 0;
    unsigned char index = 0;
    while (1)
    {
        P1 = 0;
        P0 = 0;
        P2 = 0;
        P0 = Font[m + index];
        P2 = Font[m + index + 16];
        P1 |= m & 0x07; //save the low 3 bits, throw away the high 5 bits, 0 ~7, eight status
        if (m < 8)
        {
            U15E3 = 1;
            U14E3 = 0;
        }
        else
        {
            U14E3 = 1;
            U15E3 = 0;
        }
        if (++m == 16)
        {
            index += 16;
            if (index == 48)
            {
                index = 0;
            }
            m = 0;
            for (n = 0; n < 50000; n++)
                ;
        }
        for (n = 0; n < 80; n++)
            ;
    }
}